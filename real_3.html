<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“ AIå¯«ä½œå°å¸« - åˆ†å±¤å»ºè­°ç³»çµ±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Microsoft JhengHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .header {
            background: #667eea;
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 450px;
            gap: 20px;
            padding: 30px;
            min-height: 600px;
        }

        .writing-area {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .topic-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid #28a745;
        }

        .topic-section h3 {
            color: #28a745;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }

        .topic-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
        }

        .topic-input:focus {
            outline: none;
            border-color: #28a745;
        }

        .writing-section {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .writing-section h3 {
            color: #495057;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

.writing-textarea {
    flex: 1;
    min-height: 400px;
    padding: 20px;
    border: 2px solid #e1e5e9;
    border-radius: 12px;
    font-size: 20px;
    line-height: 1.8;
    resize: vertical;
    font-family: 'Georgia', 'Times New Roman', serif;
}

        .writing-textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .writing-stats {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            color: #6c757d;
            font-size: 0.9rem;
        }

        .idea-panel {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            display: flex;
            flex-direction: column;
        }

        .idea-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .idea-header h3 {
            color: #495057;
            margin-bottom: 10px;
            font-size: 1.3rem;
        }

        .idea-btn {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }

        .idea-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
        }

        .idea-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .suggestions-container {
            flex: 1;
            margin-top: 20px;
        }

        .loading-suggestions {
            display: none;
            text-align: center;
            padding: 40px 20px;
            color: #667eea;
        }

        .loading-suggestions.show {
            display: block;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #e1e5e9;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .suggestions-content {
            display: none;
        }

        .suggestions-content.show {
            display: block;
        }

        .analysis-info {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
            font-size: 0.9rem;
            color: #1976d2;
        }

        .suggestion-group {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .suggestion-group.completion {
            border-left: 4px solid #ff9800;
        }

        .suggestion-group.next {
            border-left: 4px solid #2196f3;
        }

        .suggestion-title {
            font-weight: bold;
            color: #495057;
            margin-bottom: 15px;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .suggestion-item {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .suggestion-item:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .suggestion-item.selected {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        .suggestion-text {
            font-weight: 500;
            margin-bottom: 5px;
            font-style: italic;
        }

        .suggestion-explanation {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .writing-directions {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-left: 4px solid #9c27b0;
        }

        .direction-item {
            padding: 12px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .direction-item:last-child {
            border-bottom: none;
        }

        .direction-title {
            font-weight: 600;
            color: #495057;
            margin-bottom: 5px;
        }

        .direction-desc {
            color: #6c757d;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #6c757d;
        }

        .tips-panel {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .tips-title {
            color: #856404;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .tips-content {
            color: #856404;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .topic-examples {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
            max-height: 120px;
            overflow-y: auto;
        }

        .topic-tag {
            background: #e3f2fd;
            color: #1976d2;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .topic-tag:hover {
            background: #1976d2;
            color: white;
            transform: translateY(-1px);
        }

        @media (max-width: 968px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .idea-panel {
                order: -1;
            }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8rem;
            }
            
            .main-content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header" style="position: relative;">
            <h1>ğŸ“ AIå¯«ä½œå°å¸«</h1>
            <p>åˆ†å±¤å»ºè­°ç³»çµ± - å®Œæˆå¥å­ â†’ ä¸‹ä¸€å¥ â†’ å¯«ä½œæ–¹å‘</p>
        </div>
        <div class="main-content">
            <div class="writing-area">
                <div class="topic-section">
                    <h3>ğŸ“‹ ä½œæ–‡ä¸»é¡Œ</h3>
                    <input type="text" class="topic-input" id="topicInput" 
                           placeholder="ä¾‹å¦‚ï¼šBeing a Proud Taiwanese æˆ– My Most Memorable Travel Experience">
                    <div style="font-size: 0.9rem; color: #6c757d; margin-top: 8px;">å¸¸è¦‹ä¸»é¡Œï¼š</div>
                    <div class="topic-examples">
                        <span class="topic-tag" onclick="setTopic('Being a Proud Taiwanese')">èº«ç‚ºå°ç£äººçš„é©•å‚²</span>
                        <span class="topic-tag" onclick="setTopic('Campus Safety Issues')">æ ¡åœ’å®‰å…¨</span>
                        <span class="topic-tag" onclick="setTopic('My Most Memorable Travel Experience')">æ—…è¡Œç¶“é©—</span>
                        <span class="topic-tag" onclick="setTopic('The Stress of Exam Life')">è€ƒè©¦ç”Ÿæ´»</span>
                        <span class="topic-tag" onclick="setTopic('A Time When I Was Misunderstood')">è¢«èª¤è§£çš„ç¶“é©—</span>
                        <span class="topic-tag" onclick="setTopic('The Meaning of Graduation Ceremony')">ç•¢æ¥­å…¸ç¦®çš„æ„ç¾©</span>
                        <span class="topic-tag" onclick="setTopic('A World Without Electricity')">æ²’æœ‰é›»çš„ä¸–ç•Œ</span>
                        <span class="topic-tag" onclick="setTopic('An Unforgettable Advertisement')">å°è±¡æ·±åˆ»çš„å»£å‘Š</span>
                        <span class="topic-tag" onclick="setTopic('A Scent That Brings Back Memories')">é›£å¿˜çš„æ°£å‘³</span>
                    </div>
                </div>

                <div class="writing-section">
                    <h3>âœï¸ é–‹å§‹å¯«ä½œ</h3>
                    <textarea class="writing-textarea" id="essayContent" 
                              placeholder="åœ¨é€™è£¡é–‹å§‹å¯«ä½ çš„è‹±æ–‡ä½œæ–‡...
ä¾‹å¦‚ï¼šTaiwan is a beautiful island that I am proud to call home...

ç•¶ä½ ä¸çŸ¥é“è©²å¯«ä»€éº¼æˆ–å¥å­å¯«åˆ°ä¸€åŠä¸çŸ¥é“æ€éº¼å®Œæˆæ™‚ï¼Œå°±æŒ‰å³é‚Šçš„ã€Œé»å­éµã€ï¼"
                              oninput="updateWordCount()"></textarea>
                    <div class="writing-stats">
                        <span id="wordCount">å­—æ•¸: 0</span>
                        <span id="sentenceStatus">å¥å­ç‹€æ…‹: æº–å‚™ä¸­</span>
                    </div>
                </div>
            </div>

            <div class="idea-panel">
                <div class="idea-header">
                    <h3>ğŸ’¡ å¯«ä½œé»å­åŠ©æ‰‹</h3>
                    <div style="display: flex; gap: 10px; justify-content: center; align-items: center; flex-wrap: wrap;">
                        <button class="idea-btn" id="ideaBtn" onclick="getWritingIdeas()">
                            ğŸš€ é»å­éµ
                        </button>
                        <a href="https://mjib007.github.io/homepage/essay_11.html" target="_blank" 
                        class="idea-btn" style="text-decoration: none; background: #dc3545;">
                            ğŸ“ æ‰¹æ”¹ç³»çµ±
                        </a>
                    </div>
                    <div style="text-align: center; font-size: 0.8em; color: #666; margin-top: 8px;">
                        æƒ³çŸ¥é“åˆ†æ•¸å—ï¼Ÿé»æ‰¹æ”¹ç³»çµ±ï¼
                    </div>
                </div>

                <div class="tips-panel">
                    <div class="tips-title">ğŸ’­ ä½¿ç”¨æŠ€å·§</div>
                    <div class="tips-content">
                        <strong>åˆ†å±¤å»ºè­°ç³»çµ±ï¼š</strong><br>
                        1. ğŸ“ å…ˆå®Œæˆç•¶å‰å¥å­<br>
                        2. âœ¨ å†æä¾›ä¸‹ä¸€å¥å»ºè­°<br>
                        3. ğŸ¯ æœ€å¾Œçµ¦å‡ºå¯«ä½œæ–¹å‘<br><br>
                        <strong>æœ€é©åˆï¼š</strong>å¯«åˆ°ä¸€åŠå¡ä½çš„æ™‚å€™ï¼
                    </div>
                </div>

                <div class="suggestions-container">
                    <div class="empty-state" id="emptyState">
                        <div style="font-size: 3rem;">ğŸ¤”</div>
                        <p><strong>æº–å‚™å¥½äº†å—ï¼Ÿ</strong></p>
                        <p>å¡«å¯«ä¸»é¡Œå¾Œé–‹å§‹å¯«ä½œï¼Œ<br>å¡ä½æ™‚å°±æŒ‰ä¸‹ã€Œé»å­éµã€ï¼</p>
                    </div>

                    <div class="loading-suggestions" id="loadingSuggestions">
                        <div class="loading-spinner"></div>
                        <div><strong>ğŸ¤– AIå°å¸«æ­£åœ¨åˆ†æ...</strong></div>
                        <div style="font-size: 0.9rem; margin-top: 8px;">åˆ†å±¤æä¾›æœ€é©åˆçš„å»ºè­°</div>
                    </div>

                    <div class="suggestions-content" id="suggestionsContent">
                        <!-- åˆ†æè³‡è¨Š -->
                        <div class="analysis-info" id="analysisInfo" style="display: none;">
                            <!-- AIåˆ†æçµæœ -->
                        </div>

                        <!-- å¥å­å®Œæˆå»ºè­° -->
                        <div class="suggestion-group completion" id="completionGroup" style="display: none;">
                            <div class="suggestion-title">ğŸ¯ å…ˆå®Œæˆé€™å€‹å¥å­</div>
                            <div id="completionSuggestions">
                                <!-- å¥å­å®Œæˆå»ºè­° -->
                            </div>
                        </div>
                        
                        <!-- ä¸‹ä¸€å¥å»ºè­° -->
                        <div class="suggestion-group next" id="nextGroup" style="display: none;">
                            <div class="suggestion-title">âœ¨ æ¥ä¸‹ä¾†å¯ä»¥é€™æ¨£å¯«</div>
                            <div id="nextSuggestions">
                                <!-- ä¸‹ä¸€å¥å»ºè­° -->
                            </div>
                        </div>

                        <!-- å¯«ä½œæ–¹å‘å»ºè­° -->
                        <div class="writing-directions" id="writingDirectionsGroup" style="display: none;">
                            <div class="suggestion-title">ğŸ¯ å¯«ä½œæ–¹å‘å»ºè­°</div>
                            <div id="writingDirections">
                                <!-- å¯«ä½œæ–¹å‘å»ºè­° -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // å…¨åŸŸè®Šæ•¸
        let currentCompletionSuggestions = [];
        let currentNextSuggestions = [];
        let selectedSuggestion = -1;
        let selectedType = '';

        // è¨­å®šç¯„ä¾‹ä¸»é¡Œ
        function setTopic(topic) {
            document.getElementById('topicInput').value = topic;
        }

        // æ›´æ–°å­—æ•¸çµ±è¨ˆ
        function updateWordCount() {
            const content = document.getElementById('essayContent').value;
            const wordCount = content.trim() === '' ? 0 : content.trim().split(/\s+/).length;
            document.getElementById('wordCount').textContent = `å­—æ•¸: ${wordCount}`;
            
            // åˆ†æå¥å­ç‹€æ…‹
            const isIncomplete = !content.trim().endsWith('.') && !content.trim().endsWith('!') && !content.trim().endsWith('?') && content.trim().length > 0;
            const statusText = content.trim().length === 0 ? 'æº–å‚™ä¸­' : (isIncomplete ? 'å¥å­æœªå®Œæˆ' : 'å¥å­å·²å®Œæˆ');
            document.getElementById('sentenceStatus').textContent = `å¥å­ç‹€æ…‹: ${statusText}`;
        }

        // ç²å–å¯«ä½œé»å­
        async function getWritingIdeas() {
            const topic = document.getElementById('topicInput').value.trim();
            const currentContent = document.getElementById('essayContent').value.trim();
            
            // é©—è­‰è¼¸å…¥
            if (!topic) {
                alert('è«‹å…ˆå¡«å¯«ä½œæ–‡ä¸»é¡Œï¼');
                document.getElementById('topicInput').focus();
                return;
            }

            if (!currentContent) {
                alert('è«‹å…ˆé–‹å§‹å¯«ä½œï¼Œè‡³å°‘å¯«å¹¾å€‹å­—å¾Œå†å°‹æ±‚é»å­ï¼');
                document.getElementById('essayContent').focus();
                return;
            }

            // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
            showLoadingState();
            
            try {
                const suggestions = await callOpenAIForIdeas(topic, currentContent);
                displaySuggestions(suggestions);
                
            } catch (error) {
                console.error('ç²å–å¯«ä½œé»å­å¤±æ•—:', error);
                showErrorState();
            }
        }

        // èª¿ç”¨OpenAI APIç²å–é»å­
        async function callOpenAIForIdeas(topic, currentContent) {
            try {
                // èª¿ç”¨æ‚¨çš„n8nå·¥ä½œæµç¨‹
                const response = await fetch('https://kf0630.zeabur.app/webhook/get-writing-ideas', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        topic: topic,
                        currentContent: currentContent
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const result = await response.json();
                
                if (result.success) {
                    return {
                        completionSuggestions: result.data.suggestions.completionSuggestions,
                        nextSuggestions: result.data.suggestions.nextSuggestions,
                        directions: result.data.suggestions.directions,
                        analysisNote: result.data.suggestions.analysisNote,
                        writingStage: result.data.writingStage,
                        isIncomplete: result.data.isIncomplete
                    };
                } else {
                    throw new Error(result.error || 'ç²å–å»ºè­°å¤±æ•—');
                }

            } catch (error) {
                console.error('èª¿ç”¨n8n APIå¤±æ•—:', error);
                return generateLocalFallbackSuggestions(topic, currentContent);
            }
        }

        // æœ¬åœ°å‚™ç”¨å»ºè­°å‡½æ•¸
        function generateLocalFallbackSuggestions(topic, currentContent) {
            const wordCount = currentContent.trim().split(/\s+/).length;
            const isIncomplete = !currentContent.trim().endsWith('.') && !currentContent.trim().endsWith('!') && !currentContent.trim().endsWith('?');
            
            console.log('ä½¿ç”¨æœ¬åœ°å‚™ç”¨å»ºè­°ç³»çµ±');

            let completionSuggestions = [];
            let nextSuggestions = [];
            
            if (isIncomplete) {
                completionSuggestions = [
                    {
                        text: "among people of all ages.",
                        explanation: "å¼·èª¿æ™®åŠæ€§å’Œå»£æ³›å½±éŸ¿"
                    },
                    {
                        text: "in recent years, especially during the pandemic.",
                        explanation: "åŠ å…¥æ™‚é–“èƒŒæ™¯å’Œå…·é«”åŸå› "
                    },
                    {
                        text: "as a primary communication tool worldwide.",
                        explanation: "èªªæ˜å…¶ä¸»è¦åŠŸèƒ½å’Œç¯„åœ"
                    }
                ];
            }

            if (wordCount < 50) {
                nextSuggestions = [
                    {
                        text: "This trend has significant implications for society.",
                        explanation: "å¼•å‡ºç¤¾æœƒå½±éŸ¿çš„è¨è«–"
                    },
                    {
                        text: "However, this popularity comes with both benefits and challenges.",
                        explanation: "å¹³è¡¡è§€é»ï¼Œæº–å‚™æ­£åè«–è¿°"
                    },
                    {
                        text: "To understand this phenomenon, we need to examine its various aspects.",
                        explanation: "å¼•å°é€²å…¥æ·±å…¥åˆ†æ"
                    }
                ];
            } else if (wordCount < 150) {
                nextSuggestions = [
                    {
                        text: "For instance, we can observe this in daily communication patterns.",
                        explanation: "æä¾›å…·é«”ä¾‹å­æ”¯æŒè«–é»"
                    },
                    {
                        text: "On the other hand, critics raise concerns about potential risks.",
                        explanation: "å¼•å…¥ä¸åŒè§€é»å¹³è¡¡è«–è¿°"
                    },
                    {
                        text: "Research studies consistently show similar trends across demographics.",
                        explanation: "å¼•ç”¨ç ”ç©¶å¢å¼·èªªæœåŠ›"
                    }
                ];
            } else {
                nextSuggestions = [
                    {
                        text: "In conclusion, this analysis reveals important insights.",
                        explanation: "é–‹å§‹ç¸½çµä¸»è¦ç™¼ç¾"
                    },
                    {
                        text: "Moving forward, we must consider practical solutions.",
                        explanation: "æå‡ºå¯¦éš›çš„è§£æ±ºæ–¹æ¡ˆ"
                    },
                    {
                        text: "Ultimately, balanced approaches will be most effective.",
                        explanation: "å¼·èª¿å¹³è¡¡è§£æ±ºçš„é‡è¦æ€§"
                    }
                ];
            }
            
            return {
                completionSuggestions: completionSuggestions,
                nextSuggestions: nextSuggestions,
                directions: [
                    {
                        title: "åˆ†ææ­£é¢å½±éŸ¿",
                        desc: "æ¢è¨ä¸»é¡Œå¸¶ä¾†çš„ç©æ¥µä½œç”¨å’Œå¥½è™•"
                    },
                    {
                        title: "æ¢è¨æ½›åœ¨å•é¡Œ",
                        desc: "åˆ†æå¯èƒ½å­˜åœ¨çš„è² é¢å½±éŸ¿æˆ–æŒ‘æˆ°"
                    },
                    {
                        title: "æå‡ºå¹³è¡¡è§€é»",
                        desc: "ç¶œåˆæ­£åå…©é¢ï¼Œæå‡ºå®¢è§€çš„çµè«–"
                    }
                ],
                analysisNote: `æœ¬åœ°åˆ†æï¼šå·²å¯«${wordCount}å€‹å­—ï¼Œå¥å­${isIncomplete ? 'æœªå®Œæˆ' : 'å·²å®Œæˆ'}`,
                isIncomplete: isIncomplete
            };
        }

        // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
        function showLoadingState() {
            document.getElementById('emptyState').style.display = 'none';
            document.getElementById('suggestionsContent').classList.remove('show');
            document.getElementById('loadingSuggestions').classList.add('show');
            document.getElementById('ideaBtn').disabled = true;
            document.getElementById('ideaBtn').textContent = 'æ€è€ƒä¸­...';
        }

        // é¡¯ç¤ºå»ºè­°å…§å®¹
        function displaySuggestions(suggestions) {
            document.getElementById('loadingSuggestions').classList.remove('show');
            
            // é¡¯ç¤ºåˆ†æè³‡è¨Š
            if (suggestions.analysisNote) {
                const analysisInfo = document.getElementById('analysisInfo');
                analysisInfo.innerHTML = `
                    <strong>ğŸ¤– AIåˆ†æï¼š</strong>${suggestions.analysisNote}<br>
                    ${suggestions.writingStage ? `<strong>å¯«ä½œéšæ®µï¼š</strong>${suggestions.writingStage}` : ''}
                `;
                analysisInfo.style.display = 'block';
            }

            // é¡¯ç¤ºå¥å­å®Œæˆå»ºè­°ï¼ˆå¦‚æœæœ‰ï¼‰
            const completionGroup = document.getElementById('completionGroup');
            const completionSuggestions = document.getElementById('completionSuggestions');
            
            if (suggestions.completionSuggestions && suggestions.completionSuggestions.length > 0) {
                completionSuggestions.innerHTML = '';
                suggestions.completionSuggestions.forEach((suggestion, index) => {
                    const div = document.createElement('div');
                    div.className = 'suggestion-item';
                    div.onclick = () => selectSuggestion(index, 'completion');
                    div.innerHTML = `
                        <div class="suggestion-text">"${suggestion.text}"</div>
                        <div class="suggestion-explanation">${suggestion.explanation}</div>
                    `;
                    completionSuggestions.appendChild(div);
                });
                completionGroup.style.display = 'block';
                currentCompletionSuggestions = suggestions.completionSuggestions;
            } else {
                completionGroup.style.display = 'none';
                currentCompletionSuggestions = [];
            }

            // é¡¯ç¤ºä¸‹ä¸€å¥å»ºè­°
            const nextGroup = document.getElementById('nextGroup');
            const nextSuggestions = document.getElementById('nextSuggestions');
            
            if (suggestions.nextSuggestions && suggestions.nextSuggestions.length > 0) {
                nextSuggestions.innerHTML = '';
                suggestions.nextSuggestions.forEach((suggestion, index) => {
                    const div = document.createElement('div');
                    div.className = 'suggestion-item';
                    div.onclick = () => selectSuggestion(index, 'next');
                    div.innerHTML = `
                        <div class="suggestion-text">"${suggestion.text}"</div>
                        <div class="suggestion-explanation">${suggestion.explanation}</div>
                    `;
                    nextSuggestions.appendChild(div);
                });
                nextGroup.style.display = 'block';
                currentNextSuggestions = suggestions.nextSuggestions;
            } else {
                nextGroup.style.display = 'none';
                currentNextSuggestions = [];
            }

            // é¡¯ç¤ºå¯«ä½œæ–¹å‘å»ºè­°
            const writingDirectionsGroup = document.getElementById('writingDirectionsGroup');
            const writingDirections = document.getElementById('writingDirections');
            
            if (suggestions.directions && suggestions.directions.length > 0) {
                writingDirections.innerHTML = '';
                suggestions.directions.forEach(direction => {
                    const div = document.createElement('div');
                    div.className = 'direction-item';
                    div.innerHTML = `
                        <div class="direction-title">${direction.title}</div>
                        <div class="direction-desc">${direction.desc}</div>
                    `;
                    writingDirections.appendChild(div);
                });
                writingDirectionsGroup.style.display = 'block';
            } else {
                writingDirectionsGroup.style.display = 'none';
            }

            // é¡¯ç¤ºå»ºè­°å…§å®¹
            document.getElementById('suggestionsContent').classList.add('show');
            
            // æ¢å¾©æŒ‰éˆ•ç‹€æ…‹
            document.getElementById('ideaBtn').disabled = false;
            document.getElementById('ideaBtn').textContent = 'ğŸš€ é»å­éµ';
        }

        // é¸æ“‡å»ºè­°
        function selectSuggestion(index, type) {
            // ç§»é™¤ä¹‹å‰çš„é¸æ“‡
            document.querySelectorAll('.suggestion-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            // é¸ä¸­ç•¶å‰é …ç›®
            let selectedItem, suggestionText;
            if (type === 'completion') {
                selectedItem = document.querySelectorAll('#completionSuggestions .suggestion-item')[index];
                suggestionText = currentCompletionSuggestions[index].text;
            } else {
                selectedItem = document.querySelectorAll('#nextSuggestions .suggestion-item')[index];
                suggestionText = currentNextSuggestions[index].text;
            }
            
            selectedItem.classList.add('selected');
            selectedSuggestion = index;
            selectedType = type;
            
            // è©¢å•æ˜¯å¦è¦æ’å…¥åˆ°ä½œæ–‡ä¸­
            setTimeout(() => {
                const actionText = type === 'completion' ? 'å®Œæˆé€™å€‹å¥å­' : 'æ·»åŠ é€™å¥è©±';
                if (confirm(`è¦${actionText}å—ï¼Ÿ`)) {
                    insertSuggestionToEssay(suggestionText, type);
                }
                selectedItem.classList.remove('selected');
            }, 500);
        }

        // å°‡å»ºè­°æ’å…¥ä½œæ–‡
        function insertSuggestionToEssay(text, type) {
            const textarea = document.getElementById('essayContent');
            const currentText = textarea.value;
            
            let newText;
            if (type === 'completion') {
                // å®Œæˆå¥å­ï¼šç›´æ¥æ¥åœ¨ç¾æœ‰å…§å®¹å¾Œé¢
                newText = currentText + text + ' ';
            } else {
                // ä¸‹ä¸€å¥ï¼šç¢ºä¿æœ‰é©ç•¶çš„é–“éš”
                newText = currentText + (currentText.endsWith(' ') ? '' : ' ') + text + ' ';
            }
            
            textarea.value = newText;
            
            // æ›´æ–°å­—æ•¸ä¸¦èšç„¦åˆ°æ–‡æœ¬æ¡†
            updateWordCount();
            textarea.focus();
            
            // å°‡å…‰æ¨™ç§»åˆ°æœ€å¾Œ
            textarea.setSelectionRange(newText.length, newText.length);
            
            // é¡¯ç¤ºæ’å…¥æˆåŠŸæç¤º
            showInsertionFeedback(type === 'completion' ? 'å¥å­å·²å®Œæˆï¼' : 'å…§å®¹å·²æ·»åŠ ï¼');
        }

        // é¡¯ç¤ºæ’å…¥æˆåŠŸåé¥‹
        function showInsertionFeedback(message) {
            const feedback = document.createElement('div');
            feedback.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #28a745;
                color: white;
                padding: 12px 20px;
                border-radius: 8px;
                z-index: 1000;
                animation: slideIn 0.3s ease;
            `;
            feedback.textContent = `âœ… ${message}`;
            
            document.body.appendChild(feedback);
            
            setTimeout(() => {
                feedback.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    if (document.body.contains(feedback)) {
                        document.body.removeChild(feedback);
                    }
                }, 300);
            }, 2000);
        }

        // é¡¯ç¤ºéŒ¯èª¤ç‹€æ…‹
        function showErrorState() {
            document.getElementById('loadingSuggestions').classList.remove('show');
            document.getElementById('ideaBtn').disabled = false;
            document.getElementById('ideaBtn').textContent = 'ğŸš€ é»å­éµ';
            
            const analysisInfo = document.getElementById('analysisInfo');
            analysisInfo.innerHTML = `
                <div style="text-align: center; color: #dc3545;">
                    <strong>ğŸ˜µ AIå°å¸«æš«æ™‚ç„¡æ³•å›æ‡‰</strong><br>
                    <span style="font-size: 0.85rem;">è«‹ç¨å¾Œå†è©¦ï¼Œæˆ–ç¹¼çºŒæ‰‹å‹•å¯«ä½œ</span>
                </div>
            `;
            analysisInfo.style.display = 'block';
            document.getElementById('suggestionsContent').classList.add('show');
        }

        // æ·»åŠ å‹•ç•«æ¨£å¼
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ“ AIå¯«ä½œå°å¸« - åˆ†å±¤å»ºè­°ç³»çµ±å·²å°±ç·’ï¼');
            
            // ç›£è½Enteréµ
            document.getElementById('topicInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    document.getElementById('essayContent').focus();
                }
            });
        });
    </script>
</body>
</html>